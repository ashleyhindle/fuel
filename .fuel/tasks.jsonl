{"id":"f-104d52","title":"Add basic retry logic to ConsumeCommand for network failures","status":"closed","description":"In ConsumeCommand.php: after agent exits with code 1, check if output contains 'ConnectError' or similar network errors. If so, auto-reopen the task and retry up to 3 times with a short delay (5s). Log retry attempts to status lines. Simple implementation - no exponential backoff needed.","type":"task","priority":1,"labels":[],"size":"m","complexity":"simple","blocked_by":[],"created_at":"2026-01-07T17:30:55+00:00","updated_at":"2026-01-07T17:33:38+00:00","consumed":true,"consumed_at":"2026-01-07T17:32:58+00:00","consume_pid":null,"commit_hash":"a05183b","consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n## Summary\n\nAdded retry logic to `ConsumeCommand` for network failures:\n\n1. **Retry detection**: On exit code 1, checks output for network error patterns:\n   - `ConnectError`, `ConnectionError`, `NetworkError`\n   - `ECONNREFUSED`, `ETIMEDOUT`, `ENOTFOUND`\n   - `Connection refused`, `Connection timed out`, `Network is unreachable`, `Name or service not known`\n\n2. **Retry mechanism**: Up to 3 retries with a 5-second delay between attempts\n\n3. **Task management**: Reopens the task before each retry and marks it as consumed again\n\n4. **Logging**: Logs retry attempts to status lines (e.g., \"ðŸ”„ Retry attempt 1/3 for f-xxxxx (network error detected)\")\n\n5. **Status messages**: Shows retry count in final failure message if retries occurred\n\nThe implementation wraps the agent execution in a retry loop that detects network errors and automatically retries without exponential backoff, as specified.\n\n**Commit**: `a05183b` - \"feat: add retry logic to ConsumeCommand for network failures\"\n\nAll closing protocol steps completed.\n"}
{"id":"f-1f458b","title":"Fix ConfigService type error - parse YAML to local var before assigning to typed property","status":"closed","description":"ConfigService.php:47 assigns Yaml::parse() directly to $this->config (typed ?array). When YAML returns a string, PHP throws TypeError before is_array check runs. Fix: parse to local var, check type, then assign.","type":"bug","priority":1,"labels":["config"],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:41:56+00:00","updated_at":"2026-01-07T17:54:53+00:00","consume_pid":78752,"commit_hash":"116733d"}
{"id":"f-2ce0e7","title":"add github markdown 'warning' block at the top of README.md about this being a giant WiP that's only been tested by one person etc","status":"closed","description":null,"type":"task","priority":2,"labels":[],"size":"m","complexity":"simple","blocked_by":[],"created_at":"2026-01-07T16:49:29+00:00","updated_at":"2026-01-07T16:49:54+00:00","consumed":true,"consumed_at":"2026-01-07T16:49:35+00:00","consume_pid":null,"consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n1. Added a GitHub markdown warning block at the top of README.md\n2. Marked task f-2ce0e7 as done\n3. Committed changes (commit hash: c8f44c0)\n4. Verified task state â€” no open tasks remaining\n\nThe warning block now appears at the top of README.md, indicating this is a work in progress that has only been tested by one person.\n"}
{"id":"f-38a11a","title":"Update InitCommand for agent/model config setup","status":"closed","description":"Modify app/Commands/InitCommand.php: add --agent and --model flags, add interactive prompts during init (choice for agent, ask for model), call ConfigService::createDefaultConfig() to write .fuel/config.yaml. Skip prompts if flags provided or no TTY.","type":"task","priority":1,"labels":[],"size":"m","complexity":"simple","blocked_by":["f-8bdbc5"],"created_at":"2026-01-07T17:24:47+00:00","updated_at":"2026-01-07T17:32:03+00:00","consumed":true,"consumed_at":"2026-01-07T17:31:07+00:00","consume_pid":null,"commit_hash":"220dc9c","consumed_exit_code":0,"consumed_output":"\nTask completed. Summary:\n\n## Task f-38a11a completed\n\n**Changes made:**\n1. Added `--agent` and `--model` flags to the `init` command signature\n2. Added interactive prompts:\n   - Agent choice (cursor-agent, claude, opencode) when no flag is provided\n   - Model input (for claude agent) when no flag is provided\n3. TTY detection: prompts are skipped when flags are provided or when not in an interactive terminal\n4. Config creation: calls `ConfigService::createDefaultConfig()` to create `.fuel/config.yaml`\n5. Config updates: updates the config file with provided agent/model values\n\n**Implementation details:**\n- Uses `$this->input->isInteractive()` and `stream_isatty(STDIN)` for TTY detection\n- Validates agent values against `VALID_AGENTS` constant\n- Updates all complexity levels with the provided agent/model when specified\n- Handles model assignment only for agents that support models (claude)\n\n**Note:** Tests require dependencies to be installed (`composer install`). The code implementation is complete and follows the requirements.\n\n**Commit:** `220dc9c` - \"feat: add agent/model flags and interactive prompts to InitCommand\"\n\nThe task has been marked as complete and the changes have been committed.\n"}
{"id":"f-40304b","title":"Add Configuration section to README.md documenting config.yaml","status":"closed","description":"README.md needs a section explaining: 1) Config file location (.fuel/config.yaml), 2) Config structure (agents section + complexity routing), 3) How to customize which agent handles each complexity level, 4) Example config YAML","type":"chore","priority":2,"labels":["docs","config"],"size":"m","complexity":"simple","blocked_by":[],"created_at":"2026-01-07T17:42:06+00:00","updated_at":"2026-01-07T18:01:35+00:00","commit_hash":"adb951d"}
{"id":"f-65b2d3","title":"Simplify ConfigService - remove per-agent flag configuration","status":"closed","description":"All agents (cursor-agent, claude, opencode) use same flags: -p for prompt, --model for model. Remove the 'agents' section from config entirely. Hardcode -p and --model flags in ConfigService. Simplify config.yaml to map complexity -> agent + model + optional args.\n\nNew config format:\n```yaml\ncomplexity:\n  trivial:\n    agent: cursor-agent\n    model: claude-sonnet-4-20250514\n  simple:\n    agent: claude\n    model: claude-sonnet-4-20250514\n  moderate:\n    agent: claude\n    model: claude-sonnet-4-20250514\n    args: [\"--mcp-server\", \"github\"]\n  complex:\n    agent: claude\n    model: claude-opus-4-20250514\n    args: [\"--dangerously-skip-permissions\"]\n```\n\nFiles to update:\n- ConfigService.php: Remove agents section validation, simplify getAgentCommand to build [agent, -p, prompt, --model, model, ...args]\n- InitCommand.php: Simpler createDefaultConfig without agents section\n- ConfigServiceTest.php: Update tests for new simpler format\n- .fuel/config.yaml: Convert to new format","type":"chore","priority":1,"labels":["config","refactor"],"size":"m","complexity":"simple","blocked_by":[],"created_at":"2026-01-07T17:45:45+00:00","updated_at":"2026-01-07T18:00:01+00:00","commit_hash":"6d54794"}
{"id":"f-6d5ba1","title":"Design \"fuel others\" command to show active agent activity","status":"open","description":"Design a new command that shows what other agents are currently working on. Use case: when an agent sees test failures, they can check if another agent is actively editing files that might cause conflicts.\n\nDecisions needed:\n1. How to track agent activity? Options:\n   - Lock files with agent ID + timestamp + files being edited\n   - Separate activity log file\n   - Extend tasks.jsonl with \"claimed_by\" and \"editing_files\" fields\n\n2. What info to show?\n   - Which tasks are in_progress and by whom\n   - Which files are being edited\n   - How recent the activity is (stale detection)\n\n3. How do agents register themselves?\n   - On `fuel start` with an agent ID?\n   - Heartbeat mechanism?\n   - Just use in_progress tasks as proxy?\n\n4. Output format for the command\n\nThis affects how agents coordinate and avoid stepping on each other.","type":"feature","priority":1,"labels":["needs-human","design"],"size":"m","complexity":"moderate","blocked_by":[],"created_at":"2026-01-07T17:59:14+00:00","updated_at":"2026-01-07T17:59:14+00:00"}
{"id":"f-79ee22","title":"Remove unused RuntimeException import from ConfigServiceTest","status":"closed","description":"ConfigServiceTest.php:4 has 'use RuntimeException;' which triggers a PHP warning about non-compound name having no effect. Remove the import line.","type":"chore","priority":3,"labels":["tests"],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:41:56+00:00","updated_at":"2026-01-07T17:49:04+00:00","commit_hash":"f7d0274"}
{"id":"f-7e548d","title":"Deduplicate VALID_AGENTS constant - move to ConfigService and reference from InitCommand","status":"closed","description":"VALID_AGENTS is defined in both ConfigService.php:12 and InitCommand.php:16. Move to ConfigService as public const, have InitCommand reference it.","type":"chore","priority":2,"labels":["config","refactor"],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:41:56+00:00","updated_at":"2026-01-07T18:00:16+00:00","reason":"No longer needed - VALID_AGENTS removed in simplification (6d54794)"}
{"id":"f-8bdbc5","title":"Add ConfigService for YAML config loading","status":"closed","description":"Create app/Services/ConfigService.php that: loads .fuel/config.yaml, validates agent names against presets (cursor-agent, claude, opencode), builds command arrays with prompt and optional model args, provides getAgentCommand(complexity, prompt) and getAgentConfig(complexity) methods. Follow TaskService patterns. Register as singleton in AppServiceProvider.","type":"task","priority":1,"labels":[],"size":"m","complexity":"moderate","blocked_by":[],"created_at":"2026-01-07T17:24:25+00:00","updated_at":"2026-01-07T17:31:06+00:00","consume_pid":null,"consumed":true,"consumed_at":"2026-01-07T17:30:19+00:00","commit_hash":"65f0663","consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n## Summary\n\n**Task f-8bdbc5: Add ConfigService for YAML config loading** â€” Complete\n\n### Implementation\n\n1. **ConfigService.php** (`app/Services/ConfigService.php`)\n   - Loads `.fuel/config.yaml` using Symfony YAML\n   - Validates agent names against presets (cursor-agent, claude, opencode)\n   - Builds command arrays with prompt and optional model args\n   - Provides `getAgentCommand(complexity, prompt)` method\n   - Provides `getAgentConfig(complexity)` method\n   - Follows TaskService patterns (validation, error handling, structure)\n   - Includes `createDefaultConfig()` for initialization\n\n2. **Tests** (`tests/Unit/ConfigServiceTest.php`)\n   - Tests for config loading, validation, command building, and error handling\n\n3. **Service Provider** (`app/Providers/AppServiceProvider.php`)\n   - ConfigService registered as singleton (already done)\n\n### Closing Protocol Completed\n\n- Code formatted with Pint\n- Files staged and committed (commit: `65f0663`)\n- Task marked as done\n- Task state verified\n\n**Note:** Tests require `symfony/yaml` to be installed (already in `composer.json`). Run `composer install` to install dependencies and run the full test suite.\n\nThe ConfigService is ready to use. Dependent tasks (f-38a11a, f-bb62a6) can now proceed.\n"}
{"id":"f-94f1aa","title":"Test docs type","status":"closed","description":null,"type":"docs","priority":2,"labels":[],"size":"m","complexity":"simple","blocked_by":[],"created_at":"2026-01-07T17:51:36+00:00","updated_at":"2026-01-07T17:51:42+00:00","reason":"Test task"}
{"id":"f-9c1dac","title":"Make InitCommand idempotent - only create starter task if tasks.jsonl is empty","status":"closed","description":"In app/Commands/InitCommand.php, wrap the starter task creation (lines 38-44) in a check: if ($taskService->all()->isEmpty()). This prevents duplicate starter tasks when running init on an already-initialized project.","type":"task","priority":2,"labels":[],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T16:57:04+00:00","updated_at":"2026-01-07T16:57:44+00:00","consumed":true,"consumed_at":"2026-01-07T16:57:08+00:00","consume_pid":null,"commit_hash":"44c389f","consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n## Summary\n\n1. Updated `InitCommand.php` to check if `tasks.jsonl` is empty before creating a starter task, wrapping lines 38-44 in `if ($taskService->all()->isEmpty())`.\n2. Added a test to verify idempotency: running `init` twice does not create duplicate starter tasks.\n3. All tests pass (including the new idempotency test).\n4. Code formatted with Pint.\n5. Committed changes: `44c389f`.\n6. Marked task `f-9c1dac` as done with the commit hash.\n\nThe `init` command is now idempotent: it only creates a starter task when `tasks.jsonl` is empty, preventing duplicates when run multiple times on an already-initialized project.\n"}
{"id":"f-a228f7","title":"Add symfony/yaml dependency","status":"closed","description":"Run: composer require symfony/yaml. Required for ConfigService YAML parsing.","type":"task","priority":1,"labels":[],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:24:47+00:00","updated_at":"2026-01-07T17:27:08+00:00","consumed":true,"consumed_at":"2026-01-07T17:26:53+00:00","consume_pid":null,"consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n**Completed:**\n1. Added `symfony/yaml` dependency to `composer.json` (version `^7.0`)\n2. Marked task f-a228f7 as done\n3. Committed changes: `feat: add symfony/yaml dependency` (commit 7428abb)\n4. Verified task state â€” task is closed\n\n**Note:** Run `composer install` or `composer update` to install the package. The dependency is now in `composer.json` and ready for ConfigService YAML parsing.\n\nThe task is complete and all closing protocol steps have been followed.\n"}
{"id":"f-a4a122","title":"Remove HTML comment from public/index.html","status":"in_progress","description":"Remove the <!-- Fuel test comment --> from public/index.html","type":"task","priority":2,"labels":[],"size":"m","complexity":"complex","blocked_by":["f-d1d2e5"],"created_at":"2026-01-07T18:03:51+00:00","updated_at":"2026-01-07T18:04:59+00:00","consumed":true,"consumed_at":"2026-01-07T18:04:52+00:00","consume_pid":null,"consumed_exit_code":1,"consumed_output":"API Error: 404 {\"type\":\"error\",\"error\":{\"type\":\"not_found_error\",\"message\":\"model: opus-4.5\"},\"request_id\":\"req_011CWtTdyxPLfw894DEH6n55\"}\n"}
{"id":"f-bb62a6","title":"Update ConsumeCommand to use ConfigService","status":"closed","description":"Modify app/Commands/ConsumeCommand.php: inject ConfigService, use getAgentCommand(task complexity, prompt) to build agent command array with model support. Keep --agent flag as override (bypasses config routing). Remove hardcoded cursor-agent default.","type":"task","priority":1,"labels":[],"size":"m","complexity":"simple","blocked_by":["f-8bdbc5"],"created_at":"2026-01-07T17:24:47+00:00","updated_at":"2026-01-07T17:32:56+00:00","consumed":true,"consumed_at":"2026-01-07T17:32:04+00:00","consume_pid":null,"commit_hash":"c06dd2a","consumed_exit_code":0,"consumed_output":"\n## Summary\n\nUpdated `ConsumeCommand` to use `ConfigService` for agent routing.\n\n### Changes Made:\n\n1. **Injected ConfigService**: Added `ConfigService` as a dependency in the `handle()` method\n2. **Removed hardcoded default**: Changed `--agent=cursor-agent` to `--agent=` (optional override)\n3. **Implemented config-based routing**: When `--agent` is not provided, the command now:\n   - Extracts task complexity (defaults to 'simple')\n   - Calls `configService->getAgentCommand($complexity, $prompt)` to get the command array with model support\n   - Handles errors gracefully with helpful messages\n4. **Preserved override behavior**: The `--agent` flag still bypasses config routing when provided\n5. **Configured cwd support**: ConfigService is configured with the cwd path when `--cwd` option is used\n\n### Implementation Details:\n\n- The command array is built dynamically based on task complexity\n- Model flags are automatically included when specified in the config\n- Error handling provides clear guidance if config is missing\n- The `--agent` override still works for manual agent selection\n\n### Status:\n\n- Code formatted and linted\n- Changes committed (commit: c06dd2a)\n- Task marked as complete\n\nThe ConsumeCommand now routes tasks to appropriate agents based on complexity as configured in `.fuel/config.yaml`, while maintaining backward compatibility with the `--agent` override flag.\n"}
{"id":"f-cdaccd","title":"Add ConfigService tests","status":"closed","description":"Create tests/Unit/ConfigServiceTest.php: test config loading, complexity routing, default fallback, invalid agent error, getAgentCommand output format. Follow existing TaskServiceTest patterns.","type":"task","priority":2,"labels":[],"size":"m","complexity":"simple","blocked_by":["f-8bdbc5"],"created_at":"2026-01-07T17:24:47+00:00","updated_at":"2026-01-07T17:37:02+00:00","consume_pid":null,"consumed":true,"consumed_at":"2026-01-07T17:36:23+00:00","commit_hash":"388305e","consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n## Summary\n\n**Task f-cdaccd: Add ConfigService tests** â€” Complete\n\n### What was done\n\n1. Reviewed and fixed `tests/Unit/ConfigServiceTest.php`:\n   - Added missing `RuntimeException` import\n   - Updated `beforeEach` to create the `.fuel` directory\n   - Tests already covered all requirements\n\n2. Test coverage verified:\n   - Config loading (file existence, YAML parsing, caching)\n   - Complexity routing (all four complexity levels)\n   - Default fallback (prompt_flag, model_flag defaults)\n   - Invalid agent error handling (validation tests)\n   - getAgentCommand output format (array structure for all complexities)\n\n3. Followed TaskServiceTest patterns:\n   - Similar `beforeEach`/`afterEach` structure\n   - Same test organization and naming\n   - Consistent use of Pest expectations\n\n### Closing protocol completed\n\n- Code formatted with Pint (passed)\n- Files staged and committed (commit: `388305e`)\n- Task marked as done\n- Task state verified\n\n**Note:** Tests require `symfony/yaml` to be installed. Run `composer install` to install dependencies before running the test suite. The tests are complete and follow the required patterns.\n"}
{"id":"f-d1d2e5","title":"Add HTML comment to public/index.html","status":"closed","description":"Add <!-- Fuel test comment --> near the top of public/index.html","type":"task","priority":2,"labels":[],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T18:03:47+00:00","updated_at":"2026-01-07T18:04:51+00:00","consumed":true,"consumed_at":"2026-01-07T18:04:40+00:00","consume_pid":null,"consumed_exit_code":0,"consumed_output":"\nTask completed.\n\n1. Added the HTML comment `<!-- Fuel test comment -->` near the top of `public/index.html` (right after the DOCTYPE declaration)\n2. Marked the task as done: `./fuel done f-d1d2e5`\n3. Committed the change: `git commit -m \"feat: add HTML comment to public/index.html\"` (commit hash: 9c9a1f3)\n4. Verified task state: `./fuel ready` shows the task is no longer in the open tasks list\n\nThe comment has been added and the change is committed.\n"}
{"id":"f-ecb93b","title":"Update default model names in ConfigService to current Claude models","status":"closed","description":"ConfigService.php:264-268 uses 'claude-3-sonnet' and 'claude-3-opus' which are outdated. Update to current model IDs like 'sonnet' or 'opus'. Also update InitCommand.php:130 model prompt examples.","type":"chore","priority":2,"labels":["config"],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:41:56+00:00","updated_at":"2026-01-07T17:53:28+00:00","commit_hash":"1b2039d"}
{"id":"f-f99b4e","title":"Add 'docs' as valid task type","status":"closed","description":"TaskService and AddCommand should accept 'docs' as a valid task type alongside bug, feature, task, epic, chore. Update VALID_TYPES constant and CLAUDE.md documentation.","type":"feature","priority":2,"labels":["enhancement"],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:43:41+00:00","updated_at":"2026-01-07T17:51:53+00:00","commit_hash":"2522272"}
{"id":"f-fc18a7","title":"Show agent name in ConsumeCommand status when spawning","status":"closed","description":"ConsumeCommand.php should display which agent it's using when spawning. Around line 190 where it shows 'Spawning agent for {taskId}', also show the agent name from config (e.g., 'Spawning cursor-agent for fuel-xxxx'). Get agent name from $agentCommandArray[0] or from ConfigService.","type":"feature","priority":1,"labels":["config","consume"],"size":"m","complexity":"trivial","blocked_by":[],"created_at":"2026-01-07T17:41:57+00:00","updated_at":"2026-01-07T17:51:22+00:00","consumed":true,"consumed_at":"2026-01-07T17:45:51+00:00","consume_pid":null,"consumed_exit_code":0,"consumed_output":""}
